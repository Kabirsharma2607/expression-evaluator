policyName: fraudDetection
description: Advanced fraud detection policy for transaction monitoring and risk assessment
version: "1.0"

rules:
  # Transaction amount patterns
  unusualHighAmount:
    expression: "featureMap.transactionAmount > featureMap.averageMonthlySpend * 5"
    description: "Transaction amount exceeds 5x average monthly spend"

  microTransaction:
    expression: "featureMap.transactionAmount < 1"
    description: "Micro transaction - potential testing pattern"

  roundAmount:
    expression: "featureMap.transactionAmount % 100 == 0 && featureMap.transactionAmount >= 1000"
    description: "Large round amount transaction"

  # Geographic and velocity patterns
  foreignTransaction:
    expression: "featureMap.merchantCountry != featureMap.customerCountry"
    description: "Transaction in foreign country"

  rapidFireTransactions:
    expression: "featureMap.transactionsLast15Minutes >= 5"
    description: "High transaction velocity in 15 minutes"

  geographicVelocity:
    expression: "featureMap.distanceFromLastTransaction > 1000 && featureMap.timeSinceLastTransactionMinutes < 60"
    description: "Impossible geographic velocity"

  unusualTimePattern:
    expression: "featureMap.transactionHour < 6 || featureMap.transactionHour > 23"
    description: "Transaction at unusual hours (late night/early morning)"

  # Merchant and card patterns
  newMerchant:
    expression: "featureMap.merchantSeenBefore == false && featureMap.transactionAmount > 500"
    description: "First transaction with merchant above $500"

  onlineTransaction:
    expression: "featureMap.transactionType == 'ONLINE' || featureMap.transactionType == 'ECOMMERCE'"
    description: "Online/e-commerce transaction"

  atmlWithdrawal:
    expression: "featureMap.transactionType == 'ATM_WITHDRAWAL' && featureMap.transactionAmount > featureMap.dailyATMLimit * 0.8"
    description: "Large ATM withdrawal near daily limit"

  # Device and authentication patterns
  newDevice:
    expression: "featureMap.deviceFingerprint != featureMap.lastKnownDevice"
    description: "Transaction from new or unrecognized device"

  failedAuthAttempts:
    expression: "featureMap.failedAuthAttemptsLast24Hours >= 3"
    description: "Multiple failed authentication attempts in 24 hours"

  # Composite fraud risk indicators
  highRiskTransaction:
    expression: "unusualHighAmount && (foreignTransaction || newDevice)"
    dependencies: ["unusualHighAmount", "foreignTransaction", "newDevice"]
    description: "High-risk transaction combining amount and location/device anomalies"

  velocityFraud:
    expression: "rapidFireTransactions && geographicVelocity"
    dependencies: ["rapidFireTransactions", "geographicVelocity"]
    description: "Velocity-based fraud pattern"

  suspiciousPattern:
    expression: "(microTransaction || roundAmount) && newMerchant && onlineTransaction"
    dependencies: ["microTransaction", "roundAmount", "newMerchant", "onlineTransaction"]
    description: "Suspicious transaction pattern"